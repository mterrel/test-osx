version: 2
jobs:
  build:
    macos:
      xcode: "11.0.0"
    environment:
      HOSTCURL: ~/project/docs/test/hostcurl.sh
    steps:
    - checkout
    - run:
        command: ./.circleci/macos_circle_vm_setup.sh
        name: macOS Docker setup
    - run:
        name: Gcloud setup
        command: ./.circleci/macos_gcloud_setup.sh
    # - run:
    #   name: GSG test
    #   command: |
    #     export HOSTCURL="$(pwd)/docs/test/hostcurl.sh"
    #     #DEBUG=clitest:output,clitest:commands markdown-clitest docs/getting_started
    - run:
        name: GKE doc test
        command: ./macos_gke_test.sh || true
    - run:
        name: GKE cleanup
        command: gcloud container clusters delete mycluster --quiet || true
